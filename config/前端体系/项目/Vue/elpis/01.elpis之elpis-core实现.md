# elpisä¹‹elpis-coreå®ç°

## æ ¸å¿ƒåŸç†

elpis-coreæ˜¯**å…¨æ ˆæ¡†æ¶**elpisçš„æœåŠ¡ç«¯å†…æ ¸ï¼Œä¸»è¦åº”ç”¨äºæœåŠ¡ç«¯æ¥å£çš„å¼€å‘ä»¥åŠé¡µé¢çš„**SSR**æ¸²æŸ“ï¼Œ**elpis-core**åŸºäº**çº¦å®šä¼˜äºé…ç½®**çš„åŸç†ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„**loader**æ¥åŠ è½½å¯¹åº”çš„æ–‡ä»¶ï¼Œå¤§å¤§èŠ‚çº¦ç”¨æˆ·çš„å¼€å‘æˆæœ¬ã€‚**elpis-core**ä½¿ç”¨æˆ·çš„æ³¨æ„åŠ›ä½¿ç”¨å§‹ç»ˆé›†ä¸­äºä¸šåŠ¡å¼€å‘ï¼Œè€Œæ— éœ€å…³æ³¨å…¶ä»–ã€‚

## elpis-coreç›®å½•ç»“æ„

~~~txt
â”œâ”€ ğŸ“elpis-core
â”‚  â”œâ”€ ğŸ“loader
â”‚  â”‚  â”œâ”€ ğŸ“„config.js
â”‚  â”‚  â”œâ”€ ğŸ“„controller.js 
â”‚  â”‚  â”œâ”€ ğŸ“„extend.js
â”‚  â”‚  â”œâ”€ ğŸ“„middleware.js
â”‚  â”‚  â”œâ”€ ğŸ“„router-schema.js
â”‚  â”‚  â”œâ”€ ğŸ“„router.js
â”‚  â”‚  â””â”€ ğŸ“„service.js
|  â”‚  â”œâ”€ ğŸ“utils
â”‚  â”œâ”€ ğŸ“„env.js
â”‚  â”œâ”€ ğŸ“„index.js
â”œâ”€ ğŸ“„index.js
~~~

## elpis-coreåº”ç”¨çš„ç›®å½•æœºæ„

~~~txt
â”œâ”€ ğŸ“app
â”‚  â”œâ”€ ğŸ“controller // å­˜æ”¾ä¸šåŠ¡å¤„ç†æ–‡ä»¶ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘çš„å¤„ç†
â”‚  â”œâ”€ ğŸ“extend // å­˜æ”¾æ‹“å±•æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šæ—¥å¿—æ–‡ä»¶...
â”‚  â”œâ”€ ğŸ“middleware // ä¸­é—´ä»¶é€»è¾‘å¤„ç†ï¼ŒæŒ‚è½½åˆ°koaå®ä¾‹è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†
â”‚  â”œâ”€ ğŸ“public
â”‚  â”‚  â”œâ”€ ğŸ“output
â”‚  â”‚  â””â”€ ğŸ“static
â”‚  â”œâ”€ ğŸ“router // è·¯ç”±æ–‡ä»¶
â”‚  â”œâ”€ ğŸ“router-schema // å¯¹ router è§„åˆ™æ ¡éªŒçš„æ–‡ä»¶ 
â”‚  â”œâ”€ ğŸ“service // æœåŠ¡å±‚çš„æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæœåŠ¡ç«¯çš„äº¤äº’
â”‚  â””â”€ ğŸ“„middleware.js // å…¨å±€çš„ä¸­é—´ä»¶
~~~

## loaderå…·ä½“å®ç°åŸç†

é€šè¿‡**glob**è¿™ä¸ªåº“è¯»å–ç›¸å¯¹åº”çš„ç›®å½•ï¼ŒåŠ è½½æ¯ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¹¶æŒ‚è½½åˆ°**Koa**å®ä¾‹ä¸Š

### controller-loaderæ¨¡å—çš„ä»£ç å®ç°

~~~js
// è¯»å–app/controllerä¸‹æ‰€æœ‰æ–‡ä»¶
const fileList = readFile(`.${sep}controller`, `.${sep}**${sep}**.js`, app)
const controllers = {}
fileList.forEach(file => {
    // æå–æ–‡ä»¶åç§°
    let name = path.resolve(file)
    // æˆªå–è·¯å¾„
    name = subPath(name, 'controller')
    // å°†custom-module/custom-controller -> customModule/customController
    name = toCamelCase(name)
    //æŒ‚è½½controlleråˆ°appå®ä¾‹
    let tempController = controllers
    const names = name.split(sep) // [customModule, customController]
    for (let i = 0, len = names.length; i < len; i++) {
        if (i === len - 1) {
            const ControllerModule = require(path.resolve(file))(app)
            // æ˜¯æ–‡ä»¶
            tempController[names[i]] = new ControllerModule()
        } else {
            // æ–‡ä»¶å¤¹
            if (!tempController[names[i]]) {
                tempController[names[i]] = {}
            }
            tempController = tempController[names[i]]
        }
    }
})
app.controller = controllers
~~~

> æ³¨ï¼šå…¶ä½™æ¨¡å—çš„loaderä¸å…¶ç±»ä¼¼ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜è¿°
